<script>
  $(function() {
    console.log("Starting...")

    // Always show Published - distill hides it if not set
    function show_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
    }

    show_byline_column('Published')

    // tweak function
    var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
    function get_meta(name, meta) {
      var ind = meta.attributes.names.value.findIndex((e) => e == name)
      var val = meta.value[ind]
      if (val.type != 'list') {
        return val.value.toString()
      }
      return val
    }

    // tweak description
    $("d-title p:not(:empty)").first().prepend("<b>Abstract</b><br>")

    // Add clickable tags
    const slug = get_meta('slug', rmd_meta)
    const doi = get_meta('doi', rmd_meta)

    var title = $("d-title h1").text()

    const newdiv = $('<div class="dt-tags" style="grid-column: page;">')
    newdiv.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
    newdiv.append('<a href="' + slug + '" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
    newdiv.append('<a href="https://twitter.com/intent/tweet?text=$title$&url=https%3A%2F%2Fdoi.org%2F' + doi + '" class="dt-tag"><i class="fab fa-twitter"></i> Tweet</a>')
    $('d-title').append(newdiv)

    // tweak by-line
    var byline = $("d-byline div.byline")
    ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
    const journal = get_meta('journal', rmd_meta)
    const volume = get_meta('volume', rmd_meta)
    const issue = get_meta('issue', rmd_meta)
    const jrtitle = get_meta('title', journal)
    const firstpage = get_meta('firstpage', journal)
    const lastpage = get_meta('lastpage', journal)
    byline.append('<div class="rjournal grid"><h3>'+jrtitle+'</h3><p>Volume '+volume+':'+issue+'</p><p>pages '+firstpage+'-'+lastpage+'</p></div>')

    const received_date = get_meta('date_received', rmd_meta)
    byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date+'</p>')

  })
</script>

<style>
    /*
  .nav-dropdown-content .nav-dropdown-header {
    text-transform: lowercase;
  }
  */

  d-byline .byline {
    grid-template-columns: 2fr 2fr 2fr 2fr 2fr;
  }

  d-title h1, d-title p, d-title figure,
  d-abstract p, d-abstract b {
    grid-column: page;
  }

  d-title .dt-tags {
    grid-column: page;
  }

  .dt-tags .dt-tag {
    text-transform: lowercase;
  }

  d-article h1 {
    line-height: 1.1em;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      justify-self: end;
    }

    nav.toc {
      border-right: 1px solid rgba(0, 0, 0, 0.1);
      border-right-width: 1px;
      border-right-style: solid;
      border-right-color: rgba(0, 0, 0, 0.1);
    }
  }

  .posts-list .dt-tags .dt-tag {
    text-transform: lowercase;
  }

  @keyframes highlight-target {
    0% {
      background-color: #ffa;
    }
    66% {
      background-color: #ffa;
    }
    100% {
      background-color: none;
    }
  }

  d-article :target, d-appendix :target {
     animation: highlight-target 3s;
  }
</style>
